---
title: "[TIL] 2022-11-07"
author: deBaeloper08
date: 2022-11-07 20:19:00 +0900
categories: [TIL]
tags: [retrofit, interceptor]
---

## ğŸ˜² ì˜¤ëŠ˜ì˜ ê°œë°œ ì¼ì§€

---

- postmanìœ¼ë¡œ ì„œë²„ í†µì‹  í…ŒìŠ¤íŠ¸ í–ˆì„ ë•Œ ì˜ ë˜ëŠ”ë° ì•ˆë“œë¡œì´ë“œì—ì„œ í…ŒìŠ¤íŠ¸í•˜ë©´ ì•ˆ ë  ë•ŒëŠ” **ë¬´ì¡°ê±´ ë‚´ê°€ ì½”ë“œë¥¼ ì˜ëª»ì§ ê±°ë‹¤...**
  - usecase, repository, datasource, api ë­ ì˜ëª»í•œê±° í•˜ë‚˜ë„ ì—†ëŠ”ë° ì™œ ì•ˆ ë˜ì§€ í–ˆì§€ë§Œ ì•Œê³  ë³´ë‹ˆ ìš”ì²­ api ì£¼ì†Œê°€ ì˜ëª» ì…ë ¥í–ˆì—ˆë‹¤..
  - flowë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” emitìœ¼ë¡œ ê°’ì„ ì¶œë ¥í–ˆëŠ”ì§€ ê¼­ í™•ì¸í•˜ì.
  - Dto ë³€ìˆ˜ëª…ë„ ì˜ í™•ì¸í•˜ì...
- Hiltì—ì„œ applicationContextë¥¼ ì‚¬ìš©í•´ì•¼ í•  ë•ŒëŠ” ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
  ```kotlin
  @Provides
  @Singleton
  fun provideXAccessTokenInterceptor(@ApplicationContext context: Context): XAccessTokenInterceptor {
      return XAccessTokenInterceptor(UserSharedPreference(context))
  }
  ```
  - SharedPreference ì‚¬ìš©í•  ë•Œ ìœ ìš©í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆì„ ê²ƒ ê°™ë‹¤.
- ì›ë˜ retrofitì—ì„œ headerë¥¼ ë¶™ì¼ ë•Œ ì§ì ‘ ë¶™ì—¬ì¤˜ì•¼ í•˜ì§€ë§Œ Interceptorë¥¼ ì‚¬ìš©í•˜ë©´ í†µì‹  ê³¼ì •ì—ì„œ Interceptorê°€ ìë™ìœ¼ë¡œ Headerë¥¼ ë¶™ì´ê²Œ í•  ìˆ˜ ìˆë‹¤.

  ```kotlin
  class XAccessTokenInterceptor @Inject constructor(
  private val sharedPref: UserSharedPreference
      ): Interceptor {
      override fun intercept(chain: Interceptor.Chain): Response {
          val token = sharedPref.getStringFromPreference("jwt")

          Log.d(TAG, "intercept token: $token")
          val request = chain.request().newBuilder()
              .addHeader("JWT-AUTHENTICATION", token)
              .build()

          Log.d(TAG, "intercept headers: ${request.headers} ")
          Log.d(TAG, "intercept body : ${request.body} ")

          return chain.proceed(request)
      }
  }
  ```

  ì´ë ‡ê²Œ Interceptorë¥¼ êµ¬í˜„í•˜ëŠ” í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ê³ 

  ```kotlin
  @Provides
  @Singleton
  fun provideOkHttpClient(xAccessTokenInterceptor: XAccessTokenInterceptor): OkHttpClient =
       OkHttpClient.Builder().addNetworkInterceptor(xAccessTokenInterceptor).build()


  @Provides
  @Singleton
  fun provideRetrofitInstance(gson: Gson, client: OkHttpClient): Retrofit = Retrofit.Builder()
      .baseUrl(SERVER_URL)
      .client(client)
      .addConverterFactory(GsonConverterFactory.create(gson))
      .build()
  ```

  ì´ëŸ° ì‹ìœ¼ë¡œ Retrofit ê°ì²´ë¥¼ ìƒì„±í•  ë•Œ clientë¡œ ë„£ì–´ì£¼ë©´ ëœë‹¤.
