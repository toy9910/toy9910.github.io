---
title: "[TIL] 2022-11-08"
author: deBaeloper08
date: 2022-11-08 20:25:00 +0900
categories: [TIL]
tags: [retrofit, interceptor, coroutine]
---

## ğŸ˜² ì˜¤ëŠ˜ì˜ ê°œë°œ ì¼ì§€

---

- ì˜¤ëŠ˜ë„ ì„œë²„ì™€ í†µì‹ í•˜ë©´ì„œ ë¬¸ì œê°€ ìƒê²¼ë‹¤. IllegalArgumentExceptionì´ ë–´ì—ˆëŠ”ë° ë³€ìˆ˜ëª…ë¶€í„° í•´ì„œ ëª¨ë“  ê²½ìš°ì˜ ìˆ˜ë¥¼ í™•ì¸í•´ë´¤ì§€ë§Œ ê·¸ë˜ë„ ì•ˆëë‹¤.
  - ì•Œê³ ë³´ë‹ˆ api í˜¸ì¶œí•¨ìˆ˜ë¥¼ suspend í•¨ìˆ˜ë¡œ ì„¤ì •í•˜ì§€ ì•Šì•„ì„œ ë°œìƒí•˜ëŠ” ì˜¤ë¥˜ì˜€ë‹¤.
  - ê²€ìƒ‰í–ˆì„ ë•Œ api í˜¸ì¶œí•  ë•ŒëŠ” suspend í•¨ìˆ˜ë¡œ í˜¸ì¶œí•´ì•¼ í•œë‹¤ëŠ” ê¸€ì„ ë´¤ëŠ”ë° ì™œ ê·¸ëŸ°ì§€ëŠ” ëª¨ë¥´ê² ë‹¤.
  - ì•„ë§ˆ ì½”ë£¨í‹´ì„ ì‚¬ìš©í•˜ë©´ì„œ ì½”ë“œ ë™ì‘ ìˆœì„œì—ì„œ ë¬¸ì œê°€ ìƒê¸´ ê²ƒ ê°™ë‹¤.
  - ì“°ë©´ì„œ ëŠë‚€ê±°ì§€ë§Œ ì½”ë£¨í‹´ì„ ì‚¬ìš©í•˜ê¸°ì— ì•„ì§ ë„ˆë¬´ ëª¨ë¥´ëŠ” ê²ƒ ê°™ë‹¤.
- ê·¸ë¦¬ê³  ì˜¤ëŠ˜ ì²˜ìŒ ì•ˆ ì‚¬ì‹¤ì´ ìˆë‹¤. @Body í˜•íƒœë¡œ String ê°’ì„ ë³´ë‚´ëŠ”ë° postmanì´ë‚˜ swaggerë¡œ í…ŒìŠ¤íŠ¸í•  ë•Œ json í˜•íƒœë¡œ key ê°’ì„ ì„¤ì •í•´ì„œ ë³´ë‚´ë©´ ì•ˆëë‹¤.
  - ì•„ë§ˆ ë³´í†µ @Bodyë¡œ ë³´ë‚¼ ë•Œ ê°ì²´ë¥¼ ë³´ë‚´ê¸° ë•Œë¬¸ì— ë³€ìˆ˜ëª…ì„ key ê°’ìœ¼ë¡œ í•˜ì§€ë§Œ String ê°™ì€ ê²½ìš°ëŠ” ë³€ìˆ˜ê°€ ì—†ê¸° ë•Œë¬¸ì— ê·¸ëƒ¥ String ê°’ë§Œ ë³´ë‚´ëŠ” ê²ƒ ê°™ë‹¤.
    ![image](https://user-images.githubusercontent.com/50603217/200550225-7cd8f7d1-9459-4413-96df-3d8f1a1e6766.png)
- Interceptor í´ë˜ìŠ¤ì˜ intercept í•¨ìˆ˜ì—ì„œ api ê²½ë¡œê°’ì— ë”°ë¼ headerë¥¼ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.

  - ```kotlin
      private val noJwtUrls = arrayListOf("/api/user/kakao/login", "/api/user/naver/login")

      val url = chain.request().url.encodedPath
      Log.d(TAG, "intercept url: $url")
      if(noJwtUrls.contains(url)) {
          Log.d(TAG, "intercept: No JWT")
          return chain.proceed(chain.request().newBuilder()
              .build())
      }
    ```

    ì—¬ê¸°ì„œëŠ” noJwtUrls ë°°ì—´ ì•ˆì— ìˆëŠ” ê²½ë¡œ ì¤‘ í•˜ë‚˜ë©´ Headerë¥¼ ì•ˆ ë¶™ì´ë„ë¡ í–ˆë‹¤.

- LoginActivityì—ì„œ ë¡œê·¸ì¸ì„ ì„±ê³µí•˜ë©´ MainActivityë¥¼ ë„ìš°ê³  MainActivityì—ì„œ ë’¤ë¡œê°€ê¸°ë¥¼ ëˆ„ë¥´ë©´ ì•±ì´ ì¢…ë£Œë˜ë„ë¡ LoginActivityë¥¼ Taskì—ì„œ ì‚­ì œí•˜ê³  MainActivityë¥¼ í˜¸ì¶œí•˜ê³  ì‹¶ì—ˆë‹¤.
  - ````kotlin
        intent.flags = Intent.FLAG_ACTIVITY_NEW_TASK or Intent.FLAG_ACTIVITY_CLEAR_TASK or Intent.FLAG_ACTIVITY_CLEAR_TOP
        ```
    Intentì˜ flag ê°’ë“¤ì„ ìœ„ì²˜ëŸ¼ ì„¤ì •í•˜ì—¬ í•´ê²°í–ˆë‹¤.
    ````
