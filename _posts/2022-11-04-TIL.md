---
layout: post
title: "[TIL] 2022-11-04"
author: deBaeloper08
date: 2022-11-05 12:49:00 +0900
categories: [TIL]
tags: [paging3, retrofit, gson]
---

## ğŸ˜² ì˜¤ëŠ˜ì˜ ê°œë°œ ì¼ì§€

---

- Clean Architectureì—ì„œ Pagingì„ ì ìš©ì‹œí‚¤ëŠ”ë° ì• ë¥¼ ë¨¹ì—ˆë‹¤.
  - ì›ë˜ ViewModelì—ì„œ PagingSourceë¥¼ ìƒì†ë°›ëŠ” í´ë˜ìŠ¤ë¡œ Page ê°’ì„ ê°€ì ¸ì˜¤ëŠ”ë° Clean Architecture êµ¬ì¡°ë¡œ í•´ì•¼í–ˆê¸°ì— ViewModelì—ëŠ” UseCaseë§Œ ë„£ì—ˆë‹¤.
  - Apië¡œë¶€í„° Pageê°’ì„ ë°›ì•„ì˜¤ê³  -> DataSourceì—ì„œ Repositoryë¡œ ê°’ì„ ê·¸ëŒ€ë¡œ ë„˜ê²¨ì¤€ë‹¤ -> Repositoryì—ì„œ Paging ì²˜ë¦¬ë¥¼ í•´ì¤€ í›„ PagingSource.LoadResult ê°’ì„ ë°˜í™˜í•œë‹¤.
  - RepositoryëŠ” Domain ì˜ì—­ì´ê¸°ì— ì•ˆë“œë¡œì´ë“œì— ì˜ì¡´í•˜ë©´ ì•ˆë¼ì„œ Pagingì„ ì•„ë˜ì™€ ê°™ì´ implent í–ˆë‹¤.
  ```gradle
  // Paging3
  implementation "androidx.paging:paging-common:3.1.1"
  ```
- ì„œë²„ì™€ í†µì‹ í•˜ëŠ” ê³¼ì •ì—ì„œ ì¹´ì¹´ì˜¤ì™€ ë„¤ì´ë²„ì—ì„œ ë°›ì€ í† í° ê°’ì„ ë„˜ê²¨ accessToken ê°’ì„ ë°›ì•„ì™€ì•¼í•˜ëŠ”ë° ìê¾¸ 500 errorê°€ ë°œìƒí–ˆë‹¤.

  - ì•Œê³  ë³´ë‹ˆ ì„œë²„í•œí…Œ ë„˜ê¸°ëŠ” í† í°ê°’ ë§ˆì§€ë§‰ì´ '='ìœ¼ë¡œ ëë‚˜ëŠ”ë° ì´ê²Œ ì¸ì‹ì´ ì•ˆë¼ì„œ ìœ ë‹ˆì½”ë“œë¡œ ë³€ê²½ë˜ì–´ ì„œë²„ì— ì „ì†¡ëë‹¤.
  - ê²€ìƒ‰í•´ë³¸ ê²°ê³¼ gson ì„¤ì •ì„ ë°”ê¿”ì£¼ë©´ ë˜ì—ˆë‹¤.

  ```kotlin
  val gson = GsonBuilder().disableHtmlEscaping().create()

  Retrofit.Builder()
      .baseUrl(SERVER_URL)
      .client(OkHttpClient.Builder().addInterceptor(interceptor).build())
      .addConverterFactory(GsonConverterFactory.create(gson))
      .build()
  ```

- ì„œë²„ì™€ í†µì‹ í•  ë•Œ ê²°ê³¼ê°’ í´ë˜ìŠ¤ë¥¼ í•˜ë‚˜ ë§Œë“¤ì–´ì„œ í†µì‹ í•˜ë‹ˆ ë§ì´ í¸í–ˆë‹¤.

  - ì´ì²˜ëŸ¼ ResultStateë¼ëŠ” í´ë˜ìŠ¤ë¡œ í†µì‹  ê³¼ì •ì„ ë‚˜íƒ€ë‚¼ ìˆ˜ ìˆë‹¤.

  ```kotlin
      sealed class ResultState<out T> {
      object Uninitialized : ResultState<Nothing>()
      object Loading : ResultState<Nothing>()
      object Empty : ResultState<Nothing>()
      data class Success<T>(val data: T) : ResultState<T>()
      data class Error(val exception: Throwable) : ResultState<Nothing>() {
          val isNetworkError = exception is IOException
      }
  }
  ```

  í†µì‹  ê³¼ì •

  ```kotlin
  override fun loginNaverUser(token: String): Flow<ResultState<User>> = flow {
      var user = User()

      Log.d(TAG, "loginNaverUser: $TAG: Loading")
      emit(ResultState.Loading)
      userRemoteDataSource.loginNaverUser(token).collect {
          Log.d(TAG, "loginNaverUser $TAG: collect ${it.body()!!}")
          emit(ResultState.Success(mapperToUser(it.body()!!)))
      }
  ```

  ì´ë ‡ê²Œ ì²˜ìŒì— Loading ìƒíƒœë¡œ ì„¤ì •í•˜ê³  ê°’ì„ ë„˜ê¸°ë©´ì„œ Success ìƒíƒœë¡œ ë°”ê¿”ì¤€ë‹¤.

  - ì´ ê²½ìš°ëŠ” flowë‘ ê°™ì´ ì‚¬ìš©í•˜ë©´ ë§ì´ í¸í•  ê²ƒ ê°™ë‹¤.
  - flowë¶€í„° ê³µë¶€í•´ì•¼í• ë“¯....
